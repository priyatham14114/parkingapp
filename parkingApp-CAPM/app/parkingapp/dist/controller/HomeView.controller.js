sap.ui.define(["./basecontroller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","../Secrets/Config"],function(e,t,s,i,n,a,r,o){"use strict";return e.extend("com.app.parkingapp.controller.HomeView",{onInit:function(){const e=new t({driverName:"",driverMobile:"",vehicleNumber:"",deliveryType:"",checkInTime:"",slotNumber:{slotNumbers:""}});this.getView().setModel(e,"newAssign");var s=new t({editable:false});this.getView().setModel(s,"view")},onEditPress:function(){debugger;var e=this.byId("idAssignedTable");var t=e.getSelectedItem();if(!t){a.show("Please select record to edit.");return}const s=t.getBindingContext().getObject(),i=s.slotNumber.slotNumbers;t.getCells()[5].getItems()[0].setVisible(false);t.getCells()[5].getItems()[1].setVisible(true);this.byId("idBtnEdit").setVisible(false);this.byId("idBtnSave").setVisible(true);this.byId("idBtnCancel").setVisible(true);this.byId("idBtUnassign").setVisible(false)},onSavePress:function(){debugger;const e=this;var t=this.byId("idAssignedTable");var s=t.getSelectedItem(),r=s.getBindingContext().getObject();var o=this.getView().getModel();s.getCells()[5].getItems()[0].setVisible(true);s.getCells()[5].getItems()[1].setVisible(false);var l=s.getCells()[5].getItems()[0].getText();var d=s.getCells()[5].getItems()[1].getSelectedKey();var u=o.bindList("/assignedSlots");u.filter([new i("slotNumber/slotNumbers",n.EQ,l)]);const g=u.requestContexts().then(function(e){if(e.length>0){var t=e[0];var s=t.getObject();s.slotNumber=d;t.setProperty("slotNumber_ID",s.slotNumber);o.submitBatch("updateGroup");o.refresh()}});var c=o.bindList("/parkingSlots");c.filter([new i("ID",n.EQ,d)]);const b=c.requestContexts().then(function(t){if(t.length>0){var s=t[0];var i=s.getObject();i.status="Not Available";s.setProperty("status",i.status);o.submitBatch("updateGroup");e.getView().byId("idAllSlots").getBinding("items").refresh();o.refresh()}else{a.show("Something went wrong")}});var c=o.bindList("/parkingSlots");c.filter([new i("slotNumbers",n.EQ,l)]);const h=c.requestContexts().then(function(t){if(t.length>0){var s=t[0];var i=s.getObject();i.status="Available";s.setProperty("status",i.status);o.submitBatch("updateGroup");e.getView().byId("idAllSlots").getBinding("items").refresh();o.refresh()}else{a.show("Something went wrong")}});this.byId("idBtnSave").setVisible(false);this.byId("idBtnEdit").setVisible(true);this.byId("idBtnCancel").setVisible(false);this.byId("idBtUnassign").setVisible(true)},onCanclePress:function(){var e=this.byId("idAssignedTable");var t=e.getSelectedItems();t.forEach(function(e){var t=e.getCells();t.forEach(function(e){if(e.getId().includes("idinTablevbox")){var t=e.getItems();t[0].setVisible(true);t[1].setVisible(false)}})});this.byId("idBtnEdit").setVisible(true);this.byId("idBtnSave").setVisible(false);this.byId("idBtnCancel").setVisible(false);this.byId("idBtUnassign").setVisible(true)},onReservationsPress:async function(){debugger;if(!this.Reservationspopup){this.Reservationspopup=await this.loadFragment("Reservations")}this.Reservationspopup.open()},onCloseReservations:function(){if(this.Reservationspopup.isOpen()){this.Reservationspopup.close()}},onSearch:function(e){debugger;var t=[];var s=e.getSource().getValue();if(s&&s.length>0){var a=new i("vehicleNumber",n.Contains,s);var r=new i("slotNumber/slotNumbers",n.Contains,s);var o=new i("driverName",n.Contains,s);var l=new i("driverMobile",n.Contains,s);var d=new i("deliveryType",n.Contains,s);var u=new i("vendor_Name",n.Contains,s);var g=new i([a,r,o,l,d,u])}var c=this.byId("idAssignedTable");var b=c.getBinding("items");b.filter(g)},onSearchHistory:function(e){debugger;var t=e.getSource().getValue();if(t&&t.length>0){var s=new i("vehicleNumber",n.Contains,t);var a=new i("historySlotNumber/slotNumbers",n.Contains,t);var r=new i("driverName",n.Contains,t);var o=new i("driverMobile",n.Contains,t);var l=new i("deliveryType",n.Contains,t);var d=new i("vendor_Name",n.Contains,t);var u=new i([s,a,r,o,l,d])}var g=this.byId("idHistoryTable");var c=g.getBinding("items");c.filter(u)},onAssignPress:function(e){debugger;var t=this;var s=new Date;var l=s.getFullYear();var d=s.getMonth()+1;var u=s.getDate();var g=s.getHours();var c=s.getMinutes();var b=s.getSeconds();var h=`${l}-${d}-${u} TIME ${g}:${c}:${b}`;const v=this.getView(),I=v.byId("idDriverName").getValue(),f=v.byId("idDriverMobile").getValue(),m=v.byId("idVehicleNUmber").getValue(),y=v.byId("idVendorName___").getValue(),p=v.byId("idTypeOfDelivery").getSelectedKey(),V=v.byId("parkingLotSelect").getSelectedKey(),S=h;var w=this.byId("parkingLotSelect");var _=w.getSelectedItem();if(_){var D=_.getText()}const N={driverName:I,driverMobile:f,vehicleNumber:m,deliveryType:p,vendor_Name:y,slotNumber_ID:V,checkInTime:S};var C=this.getView().getModel(),T=C.bindList("/assignedSlots");var M=true;if(!I||I.length<3){v.byId("idDriverName").setValueState("Error");v.byId("idDriverName").setValueStateText("Name Must Contain 3 Characters");M=false}else{v.byId("idDriverName").setValueState("None")}if(!f||f.length!==10||!/^\d+$/.test(f)){v.byId("idDriverMobile").setValueState("Error");v.byId("idDriverMobile").setValueStateText("Mobile number must be a 10-digit numeric value");M=false}else{v.byId("idDriverMobile").setValueState("None")}if(!m||!/^[A-Za-z]{2}\d{2}[A-Za-z]{2}\d{4}$/.test(m)){v.byId("idVehicleNUmber").setValueState("Error");v.byId("idVehicleNUmber").setValueStateText("Vehicle number should follow this pattern AP12BG1234");M=false}else{v.byId("idVehicleNUmber").setValueState("None")}if(!p||p==="Select"){v.byId("idTypeOfDelivery").setValueState("Error");v.byId("idTypeOfDelivery").setValueStateText("Please select atleast one option below");M=false}else{v.byId("idTypeOfDelivery").setValueState("None")}if(!V){v.byId("parkingLotSelect").setValueState("Error");M=false}else{v.byId("parkingLotSelect").setValueState("None")}if(!y||y.length<3){v.byId("idVendorName___").setValueState("Error");v.byId("idVendorName___").setValueStateText("Vendor Name Must Contain 3 Characters");M=false}else{v.byId("idVendorName___").setValueState("None")}if(!M){a.show("Please enter correct data");return}else{var x=C.bindList("/assignedSlots");x.filter([new i("vehicleNumber",n.EQ,m)]);x.requestContexts().then(function(e){if(e.length>0){r.warning("You can not Assign.A Slot for Vehicle number "+m+" already assigned")}else{const d=T.create(N);if(d){const u=o.twilio.accountSid;const g=o.twilio.authToken;const c=`+91${f}`;const b="+15856485867";const h=`Hi ${I} a Slot number ${D} is alloted to you vehicle number ${m} \nVendor name: ${y}. \nThank You,\nVishal Parking Management.`;const v=`https://api.twilio.com/2010-04-01/Accounts/${u}/Messages.json`;$.ajax({url:v,type:"POST",async:true,headers:{Authorization:"Basic "+btoa(u+":"+g)},data:{To:c,From:b,Body:h},success:function(e){a.show("if number exists SMS will be sent!")},error:function(e){a.show("Failed to send SMS: "+e)}});function p(e,t="en-US"){if("speechSynthesis"in window){var s=new SpeechSynthesisUtterance(e);s.pitch=1;s.rate=.75;s.volume=1;s.lang=t;debugger;window.speechSynthesis.speak(s)}else{console.log("Sorry, your browser does not support the Web Speech API.")}}p(`कृपया ध्यान दें। वाहन नंबर ${m} को स्लॉट नंबर ${D} द्वारा आवंटित किया गया है।`,"hi-IN");var s=t.byId("movingImage");s.setVisible(true);s.addStyleClass("animate");setTimeout(function(){s.setVisible(false)},7e3);var l=C.bindList("/parkingSlots");l.filter([new i("ID",n.EQ,V)]);l.requestContexts().then(function(e){if(e.length>0){var s=e[0];var i=s.getObject();i.status="Not Available";s.setProperty("status",i.status);C.submitBatch("updateGroup");t.getView().byId("idAllSlots").getBinding("items").refresh();C.refresh();t.getView().byId("idDriverName").setValue("");t.getView().byId("idDriverMobile").setValue("");t.getView().byId("idVehicleNUmber").setValue("");t.getView().byId("idTypeOfDelivery").setValue("Select");t.getView().byId("idVendorName___").setValue("")}else{a.show("Slot Unavailable")}})}}})}},onUnassignPress:function(e){debugger;const t=this;const s=this.getView().getModel();var r=this.byId("idAssignedTable").getSelectedItem();if(r){var l=r.getBindingContext().getObject().vehicleNumber;var d=r.getBindingContext().getObject().slotNumber.slotNumbers;var u=r.getBindingContext().getObject().driverName;var g=r.getBindingContext().getObject().deliveryType;var c=r.getBindingContext().getObject().driverMobile;var b=r.getBindingContext().getObject().checkInTime;var h=r.getBindingContext().getObject().slotNumber_ID;var v=r.getBindingContext().getObject().vendor_Name;var I=new Date;var f=I.getFullYear();var m=I.getMonth()+1;var y=I.getDate();var p=I.getHours();var V=I.getMinutes();var S=I.getSeconds();var w=`${f}-${m}-${y} TIME ${p}:${V}:${S}`;var _=w;const e={driverName:u,driverMobile:c,vehicleNumber:l,deliveryType:g,checkInTime:b,historySlotNumber_ID:h,vendor_Name:v,checkOutTime:_};const D=s.bindList("/history");r.getBindingContext().delete("$auto").then(function(){const r=o.twilio.accountSid;const g=o.twilio.authToken;const b=`+91${c}`;const h="+15856485867";const v=`Hi ${u} please move the vehicle from the parking yard.\nIgnore if already left from the yard.\nThank you,\nVishal Parking Management`;const I=`https://api.twilio.com/2010-04-01/Accounts/${r}/Messages.json`;$.ajax({url:I,type:"POST",headers:{Authorization:"Basic "+btoa(r+":"+g)},data:{To:b,From:h,Body:v},success:function(e){console.log("SMS sent successfully:",e);sap.m.MessageToast.show("SMS sent successfully!")},error:function(e){console.error("Error sending SMS:",e);sap.m.MessageToast.show("Failed to send SMS: "+e)}});var f=t.byId("movingImage2");f.setVisible(true);f.addStyleClass("animate");setTimeout(function(){f.setVisible(false)},7e3);D.create(e);t.getView().byId("idHistoryTable").getBinding("items").refresh();var m=s.bindList("/parkingSlots");m.filter([new i("slotNumbers",n.EQ,d)]);m.requestContexts().then(function(e){if(e.length>0){var i=e[0];var n=i.getObject();n.status="Available";i.setProperty("status",n.status);s.submitBatch("updateGroup");t.getView().byId("idAllSlots").getBinding("items").refresh();s.refresh()}else{a.show("Slot Unavailable")}});a.show("Vechicle "+l+" Unassigned Successfully")},function(e){a.show("Technical Issue Cannot Unassign",e)});this.getView().byId("idAssignedTable").getBinding("items").refresh()}else{a.show("Please Select a record")}},onConfirmReservePress:async function(){debugger;if(!this.confirmDialog){this.confirmDialog=await this.loadFragment("confirmBookings")}const e=this.getView().byId("idReservationsTable").getSelectedItem();if(e){const t=e.getBindingContext().getObject(),s=t.driverName,i=t.driverMobile,n=t.vehicleNumber,a=t.vendorName;this.confirmDialog.open();this.byId("_IDGendfgdInput1").setValue(s);this.byId("_IDGexgrgnInput2").setValue(i);this.byId("idasgredhmeInput").setValue(n);this.byId("idasgredhmeIn0075put").setValue(a)}else{a.show("Select a record to accept reservations")}},onCloseConfirmDialog:function(){if(this.confirmDialog.isOpen()){this.confirmDialog.close()}},onConfirmBookSlotPress:function(){debugger;const e=this;const t=this.getView().byId("_IDGendfgdInput1").getValue(),s=this.getView().byId("_IDGexgrgnInput2").getValue(),r=this.getView().byId("idasgredhmeInput").getValue(),l=this.getView().byId("idasgredhmeIn0075put").getValue(),d=this.getView().byId("idSlotReserve").getSelectedKey();var u=this.byId("idSlotReserve");var g=u.getSelectedItem();if(g){var c=g.getText()}const b={driverName:t,driverMobile:s,vehicleNumber:r,vendor_Name:l,reservedSlot_ID:d};const h=this.getView().getModel(),v=this.getView();const I=h.bindList("/reserved");var f=true;if(!t||t.length<3){v.byId("_IDGendfgdInput1").setValueState("Error");v.byId("_IDGendfgdInput1").setValueStateText("Name Must Contain 3 Characters");f=false}else{v.byId("_IDGendfgdInput1").setValueState("None")}if(!s||s.length!==10||!/^\d+$/.test(s)){v.byId("_IDGexgrgnInput2").setValueState("Error");v.byId("_IDGexgrgnInput2").setValueStateText("Mobile number must be a 10-digit numeric value");f=false}else{v.byId("_IDGexgrgnInput2").setValueState("None")}if(!r||!/^[A-Za-z]{2}\d{2}[A-Za-z]{2}\d{4}$/.test(r)){v.byId("idasgredhmeInput").setValueState("Error");v.byId("idasgredhmeInput").setValueStateText("Vehicle number should follow this pattern AP12BG1234");f=false}else{v.byId("idasgredhmeInput").setValueState("None")}if(!l||l.length<3){v.byId("idasgredhmeIn0075put").setValueState("Error");v.byId("idasgredhmeIn0075put").setValueStateText("Vendor Name Must Contain 3 Characters");f=false}else{v.byId("idasgredhmeIn0075put").setValueState("None")}if(!f){a.show("Please enter correct data");return}const m=I.create(b);if(m){const u=o.twilio.accountSid;const g=o.twilio.authToken;const b=`+91${s}`;const v="+15856485867";const I=`Hi ${t} a Slot number ${c} is reserved on your vehicle number ${r} \nVendor name: ${l}. \nThank You,\nVishal Parking Management`;const f=`https://api.twilio.com/2010-04-01/Accounts/${u}/Messages.json`;$.ajax({url:f,type:"POST",headers:{Authorization:"Basic "+btoa(u+":"+g)},data:{To:b,From:v,Body:I},success:function(e){console.log("SMS sent successfully:",e);sap.m.MessageToast.show("SMS sent successfully!")},error:function(e){console.error("Error sending SMS:",e);sap.m.MessageToast.show("Failed to send SMS: "+e)}});var y=this.byId("idReservationsTable").getSelectedItem();y.getBindingContext().delete("$auto");this.byId("_IDGendfgdInput1").setValue("");this.byId("_IDGexgrgnInput2").setValue("");this.byId("idasgredhmeInput").setValue("");this.byId("idasgredhmeIn0075put").setValue("");this.confirmDialog.close();var p=h.bindList("/parkingSlots");p.filter([new i("ID",n.EQ,d)]);p.requestContexts().then(function(t){if(t.length>0){var s=t[0];var i=s.getObject();i.status="Reserved";s.setProperty("status",i.status);h.submitBatch("updateGroup");e.getView().byId("idAllSlots").getBinding("items").refresh();h.refresh()}else{a.show("Slot Unavailable")}})}},onAssignfromReservations:async function(){debugger;if(!this.ConfirmAssignDialog){this.ConfirmAssignDialog=await this.loadFragment("ConfirmAssign")}const e=this.getView().byId("idReservedTable__").getSelectedItem(),t=e.getBindingContext().getObject(),s=t.driverName,i=t.driverMobile,n=t.vehicleNumber,a=t.vendor_Name,r=t.reservedSlot.slotNumbers;if(e){this.ConfirmAssignDialog.open();this.getView().byId("_IDGen__dfgdInput1").setValue(s);this.getView().byId("_IDGexgrsdfgnIn__put2").setValue(i);this.getView().byId("afidasgredhmeI__nput").setValue(n);this.getView().byId("idss__n0075put").setValue(a);this.getView().byId("_dhmeI__nput").setValue(r)}},onCloseAssignConfirmDialog:function(){if(this.ConfirmAssignDialog.isOpen()){this.ConfirmAssignDialog.close()}},onConfirmAssignSlotPress:function(){debugger;var e=this;const t=this.getView().byId("idReservedTable__").getSelectedItem().getBindingContext().getObject();const s=this.getView().byId("idReservedTable__").getSelectedItem().getBindingContext();var r=new Date;var o=r.getFullYear();var l=r.getMonth()+1;var d=r.getDate();var u=r.getHours();var g=r.getMinutes();var c=r.getSeconds();var b=`${o}-${l}-${d} TIME ${u}:${g}:${c}`;const h=this.getView(),v=h.byId("_IDGen__dfgdInput1").getValue(),I=h.byId("_IDGexgrsdfgnIn__put2").getValue(),f=h.byId("afidasgredhmeI__nput").getValue(),m=h.byId("idss__n0075put").getValue(),y=h.byId("_IDGewertnSelect1").getSelectedKey(),p=h.byId("_dhmeI__nput").getValue(),V=b;const S={driverName:v,driverMobile:I,vehicleNumber:f,deliveryType:y,vendor_Name:m,slotNumber_ID:t.reservedSlot.ID,checkInTime:V};var w=this.getView().getModel(),_=w.bindList("/assignedSlots");var D=true;if(!v||v.length<3){h.byId("_IDGen__dfgdInput1").setValueState("Error");h.byId("_IDGen__dfgdInput1").setValueStateText("Name Must Contain 3 Characters");D=false}else{h.byId("_IDGen__dfgdInput1").setValueState("None")}if(!I||I.length!==10||!/^\d+$/.test(I)){h.byId("_IDGexgrsdfgnIn__put2").setValueState("Error");h.byId("_IDGexgrsdfgnIn__put2").setValueStateText("Mobile number must be a 10-digit numeric value");D=false}else{h.byId("_IDGexgrsdfgnIn__put2").setValueState("None")}if(!f||!/^[A-Za-z]{2}\d{2}[A-Za-z]{2}\d{4}$/.test(f)){h.byId("afidasgredhmeI__nput").setValueState("Error");h.byId("afidasgredhmeI__nput").setValueStateText("Vehicle number should follow this pattern AP12BG1234");D=false}else{h.byId("afidasgredhmeI__nput").setValueState("None")}if(!m||m.length<3){h.byId("idss__n0075put").setValueState("Error");h.byId("idss__n0075put").setValueStateText("Vendor Name Must Contain 3 Characters");D=false}else{h.byId("idss__n0075put").setValueState("None")}if(!y||y==="Select"){h.byId("_IDGewertnSelect1").setValueState("Error");h.byId("_IDGewertnSelect1").setValueStateText("Please select atleast one option");D=false}else{h.byId("_IDGewertnSelect1").setValueState("None")}if(!p){h.byId("_dhmeI__nput").setValueState("Error");D=false}else{h.byId("_dhmeI__nput").setValueState("None")}if(!D){a.show("Please enter correct data");return}else{const e=_.create(S);if(e){a.show("allotment successful");this.getView().byId("idAssignedTable").getBinding("items").refresh();this.getView().byId("_IDGen__dfgdInput1").setValue("");this.getView().byId("_IDGexgrsdfgnIn__put2").setValue("");this.getView().byId("afidasgredhmeI__nput").setValue("");this.getView().byId("_dhmeI__nput").setValue("");this.getView().byId("idss__n0075put").setValue("");this.ConfirmAssignDialog.close();s.delete("$auto").then(function(){var e=w.bindList("/parkingSlots");e.filter([new i("slotNumbers",n.EQ,p)]);e.requestContexts().then(function(e){if(e.length>0){var t=e[0];var s=t.getObject();s.status="Not Available";t.setProperty("status",s.status);w.submitBatch("updateGroup");w.refresh()}else{a.show("Slot Unavailable")}})})}}},onRejectPress:async function(){const e=this.getView().byId("idReservationsTable").getSelectedItem();if(e){if(!this.confirmRejectDialog){this.confirmRejectDialog=await this.loadFragment("RejectConfirmation")}this.confirmRejectDialog.open()}else{r.information("Select one record to continue")}},onRejectCloseConfirmDialog:function(){if(this.confirmRejectDialog.isOpen()){this.confirmRejectDialog.close()}},onRejectReservePress:function(){debugger;const e=this.getView().byId("idReservationsTable").getSelectedItem();e.getBindingContext().delete("$auto").then(function(){a.show("Rejected")});this.confirmRejectDialog.close()},oncloseDataonDataAnalysis:function(){if(this.oDataDialog.isOpen()){this.oDataDialog.close()}},onDataAnalysisPress:async function(){debugger;if(!this.oDataDialog){this.oDataDialog=await this.loadFragment("DataAnalytics")}this.oDataDialog.open();var e=this.getOwnerComponent().getModel();var s=this;e.refresh();this._setHistoryModel();e.bindList("/parkingSlots").requestContexts().then(function(e){var i=e.map(function(e){return e.getObject()});var n=i.filter(e=>e.status==="Available").length;var a=i.filter(e=>e.status==="Not Available").length;var r=i.filter(e=>e.status==="Reserved").length;var o={Items:[{status:`Available-${n}`,Count:n},{status:`Not Available-${a}`,Count:a},{status:`Reserved-${r}`,Count:r}]};var l=new t;l.setData(o);s.getView().setModel(l,"ParkingLotModel")}).catch(function(e){console.error(e)})},_setHistoryModel:function(){debugger;var e=this.getOwnerComponent().getModel();var t=this;e.bindList("/history").requestContexts().then(function(e){var s=e.map(function(e){return e.getObject()});var i=t._processHistoryData(s);var n=new sap.ui.model.json.JSONModel;n.setData(i);t.getView().setModel(n,"HistoryModel")}).catch(function(e){console.error(e)})},_processHistoryData:function(e){var t={};e.forEach(function(e){var s=e.checkInTime.split(" TIME ");var i=new Date(s[0]);var n=i.getFullYear();var a=(i.getMonth()+1).toString().padStart(2,"0");var r=i.getDate().toString().padStart(2,"0");var o=`${n}-${a}-${r}`;if(!t[o]){t[o]={date:o,inwardCount:0,outwardCount:0,totalEntries:0}}if(e.deliveryType==="InBound"){t[o].inwardCount+=1}else if(e.deliveryType==="OutBound"){t[o].outwardCount+=1}t[o].totalEntries=t[o].inwardCount+t[o].outwardCount});return{Items:Object.values(t)}}})});
//# sourceMappingURL=HomeView.controller.js.map